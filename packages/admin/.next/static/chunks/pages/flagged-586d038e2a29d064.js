(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[251],{7606:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/flagged",function(){return t(1039)}])},2653:function(e,s,t){"use strict";var a=t(418),l=t(3542);let n=l.env.NEXT_PUBLIC_API_URL||"http://localhost:3000",r=a.Z.create({baseURL:n,timeout:3e4});r.interceptors.request.use(e=>{{let s=sessionStorage.getItem("admin_api_key");s&&(e.headers["x-admin-key"]=s)}return e}),r.interceptors.response.use(e=>e,e=>{var s;return(null===(s=e.response)||void 0===s?void 0:s.status)===401&&(sessionStorage.removeItem("admin_api_key"),window.location.href="/login"),Promise.reject(e)}),s.Z=r},1039:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return c}});var a=t(2322),l=t(2784),n=t(5632),r=t(2653),i=t(2202);function c(){let e=(0,n.useRouter)(),[s,t]=(0,l.useState)([]),[c,d]=(0,l.useState)(!0),[o,x]=(0,l.useState)({id:"",open:!1}),[h,u]=(0,l.useState)("");(0,l.useEffect)(()=>{if(!sessionStorage.getItem("admin_api_key")){e.push("/login");return}m()},[]);let m=async()=>{try{let e=await r.Z.get("/admin/flagged");t(e.data.flagged)}catch(e){console.error("Error fetching flagged events:",e),i.ZP.error("Failed to fetch flagged events")}finally{d(!1)}},p=async()=>{if(!h.trim()){i.ZP.error("Please enter notes");return}try{await r.Z.post("/admin/flagged/".concat(o.id,"/resolve"),{action:"manual_review",notes:h}),i.ZP.success("Event resolved"),x({id:"",open:!1}),u(""),m()}catch(t){var e,s;i.ZP.error((null===(e=t.response)||void 0===e?void 0:null===(s=e.data)||void 0===s?void 0:s.error)||"Failed to resolve event")}};return c?(0,a.jsx)("div",{className:"p-8",children:"Loading..."}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,a.jsx)("nav",{className:"bg-white shadow",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Flagged Events"}),(0,a.jsx)("button",{onClick:()=>e.push("/"),className:"text-blue-600",children:"â† Dashboard"})]})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-3 text-left",children:"User"}),(0,a.jsx)("th",{className:"p-3 text-left",children:"Device"}),(0,a.jsx)("th",{className:"p-3 text-left",children:"Batch"}),(0,a.jsx)("th",{className:"p-3 text-left",children:"Risk"}),(0,a.jsx)("th",{className:"p-3 text-left",children:"Reason"}),(0,a.jsx)("th",{className:"p-3 text-left",children:"Status"}),(0,a.jsx)("th",{className:"p-3 text-left",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:s.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"p-3",children:e.user_phone}),(0,a.jsx)("td",{className:"p-3 text-sm text-gray-600",children:e.device_id}),(0,a.jsx)("td",{className:"p-3",children:e.batch_name}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-sm ".concat(e.risk_score>70?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:e.risk_score})}),(0,a.jsx)("td",{className:"p-3 text-sm",children:e.reason}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-sm ".concat("open"===e.status?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.status})}),(0,a.jsx)("td",{className:"p-3",children:"open"===e.status&&(0,a.jsx)("button",{onClick:()=>x({id:e.id,open:!0}),className:"text-blue-600 hover:underline",children:"Resolve"})})]},e.id))})]})})}),o.open&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Resolve Flagged Event"}),(0,a.jsx)("textarea",{value:h,onChange:e=>u(e.target.value),placeholder:"Enter resolution notes...",className:"w-full border rounded p-2 mb-4",rows:4}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>x({id:"",open:!1}),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded",children:"Cancel"}),(0,a.jsx)("button",{onClick:p,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Resolve"})]})]})})]})}}},function(e){e.O(0,[932,774,888,179],function(){return e(e.s=7606)}),_N_E=e.O()}]);