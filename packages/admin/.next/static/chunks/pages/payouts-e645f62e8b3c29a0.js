(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[452],{6333:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/payouts",function(){return s(8612)}])},2653:function(e,t,s){"use strict";var a=s(418),n=s(3542);let r=n.env.NEXT_PUBLIC_API_URL||"http://localhost:3000",o=a.Z.create({baseURL:r,timeout:3e4});o.interceptors.request.use(e=>{{let t=sessionStorage.getItem("admin_api_key");t&&(e.headers["x-admin-key"]=t)}return e}),o.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(sessionStorage.removeItem("admin_api_key"),window.location.href="/login"),Promise.reject(e)}),t.Z=o},8612:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var a=s(2322),n=s(2784),r=s(5632),o=s(2653),c=s(2202),l=s(4152);function i(){let e=(0,r.useRouter)(),[t,s]=(0,n.useState)([]),[i,d]=(0,n.useState)(new Set),[u,p]=(0,n.useState)(!0);(0,n.useEffect)(()=>{if(!sessionStorage.getItem("admin_api_key")){e.push("/login");return}h()},[]);let h=async()=>{try{let e=await o.Z.get("/admin/payouts?status=pending");s(e.data.payouts)}catch(e){console.error("Error fetching payouts:",e),c.ZP.error("Failed to fetch payouts")}finally{p(!1)}},m=async(e,t)=>{try{await o.Z.post("/admin/payouts/".concat(e,"/approve"),{reference:t}),c.ZP.success("Payout approved"),h()}catch(e){var s,a;c.ZP.error((null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.error)||"Failed to approve payout")}},x=async()=>{if(0===i.size){c.ZP.error("Please select at least one payout");return}let e=confirm("Approve ".concat(i.size," payout(s)?"));if(e)try{let e=Array.from(i).map(e=>o.Z.post("/admin/payouts/".concat(e,"/approve"),{reference:"BULK-".concat(Date.now())}));await Promise.all(e),c.ZP.success("".concat(i.size," payout(s) approved")),d(new Set),h()}catch(e){c.ZP.error("Some payouts failed to approve")}};return u?(0,a.jsx)("div",{className:"p-8",children:"Loading..."}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,a.jsx)("nav",{className:"bg-white shadow",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Payouts Management"}),(0,a.jsx)("button",{onClick:()=>e.push("/"),className:"text-blue-600",children:"← Dashboard"})]})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-4 flex justify-between",children:[(0,a.jsxs)("button",{onClick:x,disabled:0===i.size,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:bg-gray-300",children:["Approve Selected (",i.size,")"]}),(0,a.jsx)("button",{onClick:()=>{let e=["ID,Phone,Amount,Status,Date",...t.map(e=>[e.id,e.user_phone,e.amount,e.status,e.created_at].join(","))].join("\n"),s=new Blob([e],{type:"text/csv"}),a=window.URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download="payouts-".concat(Date.now(),".csv"),n.click()},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Export CSV"})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-3 text-left",children:(0,a.jsx)("input",{type:"checkbox",onChange:e=>{e.target.checked?d(new Set(t.map(e=>e.id))):d(new Set)}})}),(0,a.jsx)("th",{className:"p-3 text-left",children:"User"}),(0,a.jsx)("th",{className:"p-3 text-left",children:"Amount (₹)"}),(0,a.jsx)("th",{className:"p-3 text-left",children:"Status"}),(0,a.jsx)("th",{className:"p-3 text-left",children:"Created"}),(0,a.jsx)("th",{className:"p-3 text-left",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:t.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)("input",{type:"checkbox",checked:i.has(e.id),onChange:t=>{let s=new Set(i);t.target.checked?s.add(e.id):s.delete(e.id),d(s)}})}),(0,a.jsx)("td",{className:"p-3",children:e.user_phone}),(0,a.jsx)("td",{className:"p-3 font-semibold",children:e.amount}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-sm ".concat("pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.status})}),(0,a.jsx)("td",{className:"p-3 text-sm text-gray-500",children:(0,l.Z)(new Date(e.created_at),"MMM d, yyyy")}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)("button",{onClick:()=>{let t=prompt("Enter reference number:");t&&m(e.id,t)},className:"text-blue-600 hover:underline",children:"Approve"})})]},e.id))})]})})]})]})}}},function(e){e.O(0,[932,152,774,888,179],function(){return e(e.s=6333)}),_N_E=e.O()}]);